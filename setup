#!/bin/bash

OMP_NUM="$(grep '^core id' /proc/cpuinfo |sort -u|wc -l)"
date="$(date "+%d-%m-%Y %H:%M:%S")"

title=`echo "\033[32m"`
selected=`echo "\033[35m"`
summary=`echo "\033[34m"`
normal=`echo "\033[m"`
menu=`echo "\033[36m"` #Blue
number=`echo "\033[33m"` #yellow
bgred=`echo "\033[41m"`
fgred=`echo "\033[31m"`
TITLE="\
${title}##########################################################\n\
${title}#### aaaaa  zzzzz  ttttt  eeeee  k   k  aaaaa  sssss #####\n\
${title}####     a     zz    t    e   e  k  k       a  ss    #####\n\
${title}#### aaaaa   zzz     t    eeeee  kkk    aaaaa  sssss #####\n\
${title}#### a   a  zz       t    e      k  k   a   a     ss #####\n\
${title}#### aaaaa  zzzzz    t    eeeee  k   k  aaaaa  sssss #####\n\
${title}##########################################################\n\
${title}#################### SIMULATION SETUP ####################\n\
${title}##########################################################\n\
${title}#---------------------------------------------------------\n\
${title}# You can run simulations using ${OMP_NUM} physical cores \n\
${title}#---------------------------------------------------------\n"

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Select the physics of the problem\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 1)${menu} Non-Relativistic Hydrodynamics (HD) ${normal}\n"
    printf "${menu}**${number} 2)${menu} Relativistic Hydrodynacmis (RHD) ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s phy
}
clear
show_menu

TITLE="\
${title}##########################################################\n\
${title}#### aaaaa  zzzzz  ttttt  eeeee  k   k  aaaaa  sssss #####\n\
${title}####     a     zz    t    e   e  k  k       a  ss    #####\n\
${title}#### aaaaa   zzz     t    eeeee  kkk    aaaaa  sssss #####\n\
${title}#### a   a  zz       t    e      k  k   a   a     ss #####\n\
${title}#### aaaaa  zzzzz    t    eeeee  k   k  aaaaa  sssss #####\n\
${title}##########################################################\n\
${title}#################### SIMULATION SETUP ####################\n\
${title}##########################################################\n\
${title}#---------------------------------------------------------\n\
${title}# You can run simulations using ${OMP_NUM} physical cores \n\
${title}#---------------------------------------------------------\n\
\n${summary}**********************************************************${normal}\n\
${summary}************************ SUMMARY *************************${normal}\n\
${summary}**********************************************************${normal}\n"

if [[ $phy == 1 ]]
then
   phy=HD
   PHYSICS='Non-Relativistic Hydrodynamics'
elif [[ $phy == 2 ]]
then
   phy=RHD
   PHYSICS='Relativistic Hydrodynamics'
elif [[ $phy == x ]]
then 
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Select the number of spatial dimensions of the problem\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 1)${menu} 1D ${normal}\n"
    printf "${menu}**${number} 2)${menu} 2D ${normal}\n"
    printf "${menu}**${number} 3)${menu} 3D ${normal}\n"
    printf "${menu}**${number} 4)${menu} 2.5D ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s dim
}
clear
show_menu

if [[ $dim == 1 ]]
then
   DIMENSIONS='1D'
elif [[ $dim == 2 ]]
then
   DIMENSIONS='2D'
elif [[ $dim == 3 ]]
then
   DIMENSIONS='3D'
elif [[ $dim == 4 ]]
then
   DIMENSIONS='2.5D'
elif [[ $dim == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Select the type of mesh grid\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 1)${menu} Cartesian ${normal}\n"
    printf "${menu}**${number} 2)${menu} Cylindrical ${normal}\n"
    printf "${menu}**${number} 3)${menu} Spherical ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s coord
}
clear
show_menu

if [[ $coord == 1 ]]
then
   coord=cartesian
   COORDINATES=Cartesian
elif [[ $coord == 2 ]]
then
   coord=cylindrical
   COORDINATES=Cylindrical
elif [[ $coord == 3 ]]
then
   coord=spherical
   COORDINATES=Spherical
elif [[ $coord == x ]]
then 
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

if [[ $phy == RHD ]]
then
show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}** Coordinates: ${selected}${COORDINATES} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Select the fixed background metric\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 0)${menu} User ${normal}\n"
    printf "${menu}**${number} 1)${menu} Minkowski ${normal}\n"
    printf "${menu}**${number} 2)${menu} Schwarzschild ${normal}\n"
    printf "${menu}**${number} 3)${menu} Eddington-Finkelstein ${normal}\n"
    printf "${menu}**${number} 4)${menu} Boyer-Lindquist ${normal}\n"
    printf "${menu}**${number} 5)${menu} Kerr-Schild ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s met
}
clear
show_menu

if [[ $met == 0 ]]
then
   metric='User'
   METRIC='- User defined space-time'
elif [[ $met == 1 ]]
then
   metric='Minkowski'
   METRIC='- Minkowski space-time'
elif [[ $met == 2 ]]
then
   metric='Schwarzschild'
   METRIC='- Schwarzschild space-time'
elif [[ $met == 3 ]]
then
   metric='Eddington-Finkelstein'
   METRIC='- Eddington-Finkelstein space-time'
elif [[ $met == 4 ]]
then
   metric='Boyer-Lindquist'
   METRIC='- Boyer-Lindquist space-time'
elif [[ $met == 5 ]]
then
   metric='Kerr-Schild'
   METRIC='- Kerr-Schild space-time'
elif [[ $met == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi
fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}** Coordinates: ${selected}${COORDINATES} ${METRIC} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Select the kind of Equation of State (EoS)\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 0)${menu} User ${normal}\n"
    printf "${menu}**${number} 1)${menu} Ideal ${normal}\n"
    printf "${menu}**${number} 2)${menu} Dust ${normal}\n"
    printf "${menu}**${number} 3)${menu} Stiff ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s eqstate
}
clear
show_menu

if [[ $eqstate == 0 ]]
then
   eos='User'
   EQUATION='User'
elif [[ $eqstate == 1 ]]
then
   eos='Ideal'
   EQUATION='Ideal'
elif [[ $eqstate == 2 ]]
then
   eos='Dust'
   EQUATION='Dust'
elif [[ $eqstate == 3 ]]
then
   eos='Stiff'
   EQUATION='Stiff'
elif [[ $eqstate == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}** Coordinates: ${selected}${COORDINATES} ${METRIC} ${normal}\n"
    printf "${summary}** Equation of State: ${selected}${EQUATION} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Do you want to add source terms to the equations?\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 1)${menu} Yes ${normal}\n"
    printf "${menu}**${number} 2)${menu} No ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s user_sources
}
clear
show_menu

if [[ $user_sources == 1 ]]
then
   user_sources=true
   USER_SOURCES='Yes'
elif [[ $user_sources == 2 ]]
then
   user_sources=false
   USER_SOURCES='No'
elif [[ $user_sources == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

GRAV="-"

if [[ $phy == "HD" ]] && [[ $user_sources == "true" ]]
then
show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}** Coordinates: ${selected}${COORDINATES} ${METRIC} ${normal}\n"
    printf "${summary}** Equation of State: ${selected}${EQUATION} ${normal}\n"
    printf "${summary}** External source terms: ${selected}${USER_SOURCES} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** Do you want gravity as a external force?\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 1)${menu} Yes ${normal}\n"
    printf "${menu}**${number} 2)${menu} No ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s grav
}
clear
show_menu

if [[ $grav == 1 ]]
then
   grav=y
   GRAV=Yes
elif [[ $grav == 2 ]]
then
   grav=n
   GRAV=No
elif [[ $grav == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Physics: ${selected}${PHYSICS} ${normal}\n"
    printf "${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n"
    printf "${summary}** Coordinates: ${selected}${COORDINATES} ${METRIC} ${normal}\n"
    printf "${summary}** Equation of State: ${selected}${EQUATION} ${normal}\n"
    printf "${summary}** External source terms: ${selected}${USER_SOURCES} ${normal}\n"
    printf "${summary}** Gravity: ${selected}${GRAV} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}**********************************************************${normal}\n"
    printf "${menu}** What kind of gravity?\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "${menu}**${number} 0)${menu} User defined ${normal}\n"
    printf "${menu}**${number} 1)${menu} Vertical constant acceleration g ${normal}\n"
    printf "${menu}**${number} 2)${menu} Newtonian (GM/r) ${normal}\n"
    printf "${menu}**********************************************************${normal}\n"
    printf "Select a number or type ${fgred}x ${normal}to exit.\n"
    read -n1 -s gravity
}
clear
show_menu

if [[ $gravity == 0 ]]
then
   GRAVITY_TYPE='- User defined'
elif [[ $gravity == 1 ]]
then
   GRAVITY_TYPE='- Vertical constant acceleration g'
elif [[ $gravity == 2 ]]
then
   GRAVITY_TYPE='- Newtonian (GM/r²)'
elif [[ $gravity == x ]]
then
   exit;
else
   printf "${fgred} Wrong selection\n"
   exit;
fi

fi

TITLE="\
${title}##########################################################\n\
${title}#### aaaaa  zzzzz  ttttt  eeeee  k   k  aaaaa  sssss #####\n\
${title}####     a     zz    t    e   e  k  k       a  ss    #####\n\
${title}#### aaaaa   zzz     t    eeeee  kkk    aaaaa  sssss #####\n\
${title}#### a   a  zz       t    e      k  k   a   a     ss #####\n\
${title}#### aaaaa  zzzzz    t    eeeee  k   k  aaaaa  sssss #####\n\
${title}##########################################################\n\
${title}#################### SIMULATION SETUP ####################\n\
${title}##########################################################\n\
${title}#---------------------------------------------------------\n\
${title}# You can run simulations using ${OMP_NUM} physical cores \n\
${title}#---------------------------------------------------------\n\
\n${summary}**********************************************************${normal}\n\
${summary}************************ SUMMARY *************************${normal}\n\
${summary}**********************************************************${normal}\n\
${summary}** Physics: ${selected}${PHYSICS} ${normal}\n\
${summary}** Dimensions: ${selected}${DIMENSIONS} ${normal}\n\
${summary}** Coordinates: ${selected}${COORDINATES} ${METRIC} ${normal}\n\
${summary}** Equation of State: ${selected}${EQUATION} ${normal}\n\
${summary}** External source terms: ${selected}${USER_SOURCES} ${normal}\n\
${summary}** Gravity: ${selected}${GRAV} ${GRAVITY_TYPE} ${normal}\n"

cat << EOF > Makefile
##################################################
#####          MAKEFILE FOR AZTEKAS          #####
##################################################
#-------------------------------------------------
# From the list below, please activate/deactivate 
# the options that apply to your run. If you 
# modify any of these options, make sure that you 
# recompile the whole code by typing 
# $ make clean && make 
#-------------------------------------------------

##################################################
# PATH TO AZTEKAS
##################################################

AZTPATH = \$(AZTEKAS_PATH)

##################################################
# SET NUMBER OF THREADS USED BY OMP
##################################################
# You can find the number of physical cores 
# using
# $ grep '^core id' /proc/cpuinfo |sort -u|wc -l
##################################################

OMP_NUM = 1

##################################################
# Physics (HD, MHD, RHD, RMHD)
##################################################

PHY = $phy

##################################################
# Dimension (1, 2 or 3. Enter 4 for 2.5)
##################################################

DIM = $dim

##################################################
# Metric (User, Minkowski, Schwarzschild, 
# Eddington-Finkelstein, Boyer-Lindquist or
# Kerr-Schild)
# ONLY IF PHY == RHD or RMHD
##################################################

METRIC = $metric

##################################################
# Equation of State (User, Ideal, Dust, Stiff)
##################################################

EOS = $eos

##################################################
# Coordinates (Cartesian, Cylindrical, Spherical)
##################################################

COORD = $COORDINATES

##################################################
# User Source Terms (true,false)
##################################################

USER_SOURCE = $user_sources

##################################################
# Integration method
##################################################

INT = standard

##################################################
# All user *.c are written here
##################################################

USR = initial.c \\
      user_boundaries.c \\
		user_input.c 

##################################################
# Include a global Makefile in the /Src/ 
# directory, which has some definitions
# of parameters, inclusions of other makefiles
# and compilation orders. Change this Makefile,
# and recursive Makefiles only if you know what
# your doing.
##################################################
include \$(AZTPATH)/Src/Makefile
EOF

#############################################################################################

if [ $dim -eq 1 ]
then
   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}**********************************************************${normal}\n"
      printf "${menu}** Set boundary in X1-max\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
      printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
      printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "Select a number or type ${fgred}x ${normal}to exit.\n"
      read -n1 -s bound_x1max
   }
   clear
   show_menu

   if [[ $bound_x1max == 1 ]]
   then
      bound_x1max="outflow_x1max   "
      BX1MAX="Outflow"
   elif [[ $bound_x1max == 2 ]]
   then
      bound_x1max="reflective_x1max"
      BX1MAX="Reflective"
   elif [[ $bound_x1max == 3 ]]
   then
      bound_x1max="periodic_x1     "
      BX1MAX="Periodic"
      bound_x1min=""
      BX1MIN="Periodic"
   elif [[ $bound_x1max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x1max != "periodic_x1     " ]]
   then
      show_menu(){
         printf "\n"
         printf "${TITLE}"
         printf "${summary}** Boundaries: ${normal}\n"
         printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
         printf "${summary}**********************************************************${normal}\n"
         printf "\n${menu}**********************************************************${normal}\n"
         printf "${menu}** Set boundary in X1-min\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
         printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "Select a number or type ${fgred}x ${normal}to exit.\n"
         read -n1 -s bound_x1min
      }
      clear
      show_menu

      if [[ $bound_x1min == 1 ]]
      then
         bound_x1min="outflow_x1min   "
         BX1MIN="Outflow"
      elif [[ $bound_x1min == 2 ]]
      then
         bound_x1min="reflective_x1min"
         BX1MIN="Reflective"
      elif [[ $bound_x1min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}** Boundaries: ${normal}\n"
      printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
      printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}Please enter the author of this simulation.${number}\n"
      read author
      printf "\n${menu}Please enter the characteristic name of this simulation.${number}\n"
      read char_name
   }
   clear
   show_menu
fi

#############################################################################################

if [ $dim -eq 2 ] || [ $dim -eq 4 ]
then
   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}**********************************************************${normal}\n"
      printf "${menu}** Set boundary in X1-max\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
      printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
      printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "Select a number or type ${fgred}x ${normal}to exit.\n"
      read -n1 -s bound_x1max
   }
   clear
   show_menu

   if [[ $bound_x1max == 1 ]]
   then
      bound_x1max="outflow_x1max   "
      BX1MAX="Outflow"
   elif [[ $bound_x1max == 2 ]]
   then
      bound_x1max="reflective_x1max"
      BX1MAX="Reflective"
   elif [[ $bound_x1max == 3 ]]
   then
      bound_x1max="periodic_x1     "
      BX1MAX="Periodic"
      bound_x1min=""
      BX1MIN="Periodic"
   elif [[ $bound_x1max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x1max != "periodic_x1     " ]]
   then
      show_menu(){
         printf "\n"
         printf "${TITLE}"
         printf "${summary}** Boundaries: ${normal}\n"
         printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
         printf "${summary}**********************************************************${normal}\n"
         printf "\n${menu}**********************************************************${normal}\n"
         printf "${menu}** Set boundary in X1-min\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
         printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "Select a number or type ${fgred}x ${normal}to exit.\n"
         read -n1 -s bound_x1min
      }
      clear
      show_menu

      if [[ $bound_x1min == 1 ]]
      then
         bound_x1min="outflow_x1min   "
         BX1MIN="Outflow"
      elif [[ $bound_x1min == 2 ]]
      then
         bound_x1min="reflective_x1min"
         BX1MIN="Reflective"
      elif [[ $bound_x1min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

   show_menu(){
       printf "\n"
       printf "${TITLE}"
       printf "${summary}** Boundaries: ${normal}\n"
       printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
       printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
       printf "${summary}**********************************************************${normal}\n"
       printf "\n${menu}**********************************************************${normal}\n"
       printf "${menu}** Set boundary in X2-max\n"
       printf "${menu}**********************************************************${normal}\n"
       printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
       printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
       printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
       printf "${menu}**********************************************************${normal}\n"
       printf "Select a number or type ${fgred}x ${normal}to exit.\n"
       read -n1 -s bound_x2max
   }
   clear
   show_menu

   if [[ $bound_x2max == 1 ]]
   then
      bound_x2max="outflow_x2max   "
      BX2MAX="Outflow"
   elif [[ $bound_x2max == 2 ]]
   then
      bound_x2max="reflective_x2max"
      BX2MAX="Reflective"
   elif [[ $bound_x2max == 3 ]]
   then
      bound_x2max="periodic_x2     "
      BX2MAX="Periodic"
      bound_x2min=""
      BX2MIN="Periodic"
   elif [[ $bound_x2max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x2max != "periodic_x2     " ]]
   then
      show_menu(){
          printf "\n"
          printf "${TITLE}"
          printf "${summary}** Boundaries: ${normal}\n"
          printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
          printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
          printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
          printf "${summary}**********************************************************${normal}\n"
          printf "\n${menu}**********************************************************${normal}\n"
          printf "${menu}** Set boundary in X2-min\n"
          printf "${menu}**********************************************************${normal}\n"
          printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
          printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
          printf "${menu}**********************************************************${normal}\n"
          printf "Select a number or type ${fgred}x ${normal}to exit.\n"
          read -n1 -s bound_x2min
   }
   clear
   show_menu

      if [[ $bound_x2min == 1 ]]
      then
         bound_x2min="outflow_x2min   "
         BX2MIN="Outflow"
      elif [[ $bound_x2min == 2 ]]
      then
         bound_x2min="reflective_x2min"
         BX2MIN="Reflective"
      elif [[ $bound_x2min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

show_menu(){
    printf "\n"
    printf "${TITLE}"
    printf "${summary}** Boundaries: ${normal}\n"
    printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
    printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
    printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
    printf "${summary}**    - X2-min: ${selected}${BX2MIN} ${normal}\n"
    printf "${summary}**********************************************************${normal}\n"
    printf "\n${menu}Please enter the author of this simulation.${number}\n"
    read author
    printf "\n${menu}Please enter the characteristic name of this simulation.${number}\n"
    read char_name
}
clear
show_menu
fi

################################################################################################

if [ $dim -eq 3 ]
then
   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}**********************************************************${normal}\n"
      printf "${menu}** Set boundary in X1-max\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
      printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
      printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "Select a number or type ${fgred}x ${normal}to exit.\n"
      read -n1 -s bound_x1max
   }
   clear
   show_menu

   if [[ $bound_x1max == 1 ]]
   then
      bound_x1max="outflow_x1max   "
      BX1MAX="Outflow"
   elif [[ $bound_x1max == 2 ]]
   then
      bound_x1max="reflective_x1max"
      BX1MAX="Reflective"
   elif [[ $bound_x1max == 3 ]]
   then
      bound_x1max="periodic_x1     "
      BX1MAX="Periodic"
      bound_x1min=""
      BX1MIN="Periodic"
   elif [[ $bound_x1max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x1max != "periodic_x1     " ]]
   then
      show_menu(){
         printf "\n"
         printf "${TITLE}"
         printf "${summary}** Boundaries: ${normal}\n"
         printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
         printf "${summary}**********************************************************${normal}\n"
         printf "\n${menu}**********************************************************${normal}\n"
         printf "${menu}** Set boundary in X1-min\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
         printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "Select a number or type ${fgred}x ${normal}to exit.\n"
         read -n1 -s bound_x1min
   }
   clear
   show_menu

      if [[ $bound_x1min == 1 ]]
      then
         bound_x1min="outflow_x1min   "
         BX1MIN="Outflow"
      elif [[ $bound_x1min == 2 ]]
      then
         bound_x1min="reflective_x1min"
         BX1MIN="Reflective"
      elif [[ $bound_x1min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}** Boundaries: ${normal}\n"
      printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
      printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}**********************************************************${normal}\n"
      printf "${menu}** Set boundary in X2-max\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
      printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
      printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "Select a number or type ${fgred}x ${normal}to exit.\n"
      read -n1 -s bound_x2max
   }
   clear
   show_menu

   if [[ $bound_x2max == 1 ]]
   then
      bound_x2max="outflow_x2max   "
      BX2MAX="Outflow"
   elif [[ $bound_x2max == 2 ]]
   then
      bound_x2max="reflective_x2max"
      BX2MAX="Reflective"
   elif [[ $bound_x2max == 3 ]]
   then
      bound_x2max="periodic_x2     "
      BX2MAX="Periodic"
      bound_x2min=""
      BX2MIN="Periodic"
   elif [[ $bound_x2max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x2max != "periodic_x2     " ]]
   then
      show_menu(){
         printf "\n"
         printf "${TITLE}"
         printf "${summary}** Boundaries: ${normal}\n"
         printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
         printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
         printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
         printf "${summary}**********************************************************${normal}\n"
         printf "\n${menu}**********************************************************${normal}\n"
         printf "${menu}** Set boundary in X2-min\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
         printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "Select a number or type ${fgred}x ${normal}to exit.\n"
         read -n1 -s bound_x2min
      }
      clear
      show_menu

      if [[ $bound_x2min == 1 ]]
      then
         bound_x2min="outflow_x2min   "
         BX2MIN="Outflow"
      elif [[ $bound_x2min == 2 ]]
      then
         bound_x2min="reflective_x2min"
         BX2MIN="Reflective"
      elif [[ $bound_x2min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}** Boundaries: ${normal}\n"
      printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
      printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
      printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
      printf "${summary}**    - X2-min: ${selected}${BX2MIN} ${normal}\n"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}**********************************************************${normal}\n"
      printf "${menu}** Set boundary in X3-max\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
      printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
      printf "${menu}**${number} 3)${menu} Periodic ${normal}\n"
      printf "${menu}**********************************************************${normal}\n"
      printf "Select a number or type ${fgred}x ${normal}to exit.\n"
      read -n1 -s bound_x3max
   }
   clear
   show_menu

   if [[ $bound_x3max == 1 ]]
   then
      bound_x3max="outflow_x3max   "
      BX3MAX="Outflow"
   elif [[ $bound_x3max == 2 ]]
   then
      bound_x3max="reflective_x3max"
      BX3MAX="Reflective"
   elif [[ $bound_x3max == 3 ]]
   then
      bound_x3max="periodic_x3     "
      BX3MAX="Periodic"
      bound_x3min=""
      BX3MIN="Periodic"
   elif [[ $bound_x3max == x ]]
   then
      exit;
   else
      printf "${fgred} Wrong selection\n"
      exit;
   fi

   if [[ $bound_x3max != "periodic_x3     " ]]
   then
      show_menu(){
         printf "\n"
         printf "${TITLE}"
         printf "${summary}** Boundaries: ${normal}\n"
         printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
         printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
         printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
         printf "${summary}**    - X2-min: ${selected}${BX2MIN} ${normal}\n"
         printf "${summary}**    - X3-max: ${selected}${BX3MAX} ${normal}\n"
         printf "${summary}**********************************************************${normal}\n"
         printf "\n${menu}**********************************************************${normal}\n"
         printf "${menu}** Set boundary in X3-min\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "${menu}**${number} 1)${menu} Outflow ${normal}\n"
         printf "${menu}**${number} 2)${menu} Reflective ${normal}\n"
         printf "${menu}**********************************************************${normal}\n"
         printf "Select a number or type ${fgred}x ${normal}to exit.\n"
         read -n1 -s bound_x3min
      }
      clear
      show_menu

      if [[ $bound_x3min == 1 ]]
      then
         bound_x3min="outflow_x3min   "
         BX3MIN="Outflow"
      elif [[ $bound_x3min == 2 ]]
      then
         bound_x3min="reflective_x3min"
         BX3MIN="Reflective"
      elif [[ $bound_x3min == x ]]
      then
         exit;
      else
         printf "${fgred} Wrong selection\n"
         exit;
      fi
   fi

   show_menu(){
      printf "\n"
      printf "${TITLE}"
      printf "${summary}** Boundaries: ${normal}\n"
      printf "${summary}**    - X1-max: ${selected}${BX1MAX} ${normal}\n"
      printf "${summary}**    - X1-min: ${selected}${BX1MIN} ${normal}\n"
      printf "${summary}**    - X2-max: ${selected}${BX2MAX} ${normal}\n"
      printf "${summary}**    - X2-min: ${selected}${BX2MIN} ${normal}\n"
      printf "${summary}**    - X3-max: ${selected}${BX3MAX} ${normal}\n"
      printf "${summary}**    - X3-min: ${selected}${BX3MIN} ${normal}\n"
      printf "${summary}**********************************************************${normal}\n"
      printf "\n${menu}Please enter the author of this simulation.${number}\n"
      read author
      printf "\n${menu}Please enter the characteristic name of this simulation.${number}\n"
      read char_name
   }
   clear
   show_menu
fi

## Date
date="$(date "+%d-%m-%Y %H:%M:%S")"

if [[ $dim == 1 ]] && [[ $bound_x1max != "periodic_x1     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
EOF
fi

if [ $dim -eq 1 ] && [[ $bound_x1max == "periodic_x1     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
EOF
fi

if [ $dim -eq 2 ] || [ $dim -eq 4 ] && [[ $bound_x1max != "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
EOF
fi

if [ $dim -eq 2 ] || [ $dim -eq 4 ] && [[ $bound_x2max != "periodic_x1     " ]] && [[ $bound_x2max == "periodic_x2     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
EOF
fi

if [ $dim -eq 2 ] || [ $dim -eq 4 ] && [[ $bound_x1max == "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
EOF
fi

if [ $dim -eq 2 ] || [ $dim -eq 4 ] && [[ $bound_x1max == "periodic_x1     " ]] && [[ $bound_x2max == "periodic_x2     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x2max}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max != "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]] && [[ $bound_x3max != "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
#define ${bound_x3max}        TRUE
#define ${bound_x3min}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max == "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]] && [[ $bound_x3max != "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
#define ${bound_x3max}        TRUE
#define ${bound_x3min}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max != "periodic_x1     " ]] && [[ $bound_x2max == "periodic_x2     " ]] && [[ $bound_x3max != "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x3max}        TRUE
#define ${bound_x3min}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max != "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]] && [[ $bound_x3max == "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
#define ${bound_x3max}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max == "periodic_x1     " ]] && [[ $bound_x2max == "periodic_x2     " ]] && [[ $bound_x3max != "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x3max}        TRUE
#define ${bound_x3min}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max == "periodic_x1     " ]] && [[ $bound_x2max != "periodic_x2     " ]] && [[ $bound_x3max == "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x2min}        TRUE
#define ${bound_x3max}        TRUE
EOF
fi

if [ $dim -eq 3 ] && [[ $bound_x1max != "periodic_x1     " ]] && [[ $bound_x2max == "periodic_x2     " ]] && [[ $bound_x3max == "periodic_x3     " ]]
then
cat << EOF > user_param.h
/* 
 *  aztekas header paremeters module
 *  Date of creation: $date
 *  author: $author 
 */

#include<macros.h>

#define ${bound_x1max}        TRUE
#define ${bound_x1min}        TRUE
#define ${bound_x2max}        TRUE
#define ${bound_x3max}        TRUE
EOF
fi

cat << EOF >> user_param.h

#define RECONST                 MC
#define FLUX                    HLL
#define GRID                    UNIFORM
EOF

cat << EOF > initial.c
/**
 * @file initial.c
 * 
 * @brief aztekas initial module
 * 
 * @author $author 
 *
 * @date $date
 */

#include"main.h"

void Initial()
{
   //Initialize time
   grid.time = 0.0;

   //Initialize dt
   dt = 0.0;
}
EOF

cat << EOF > user_boundaries.c
/**
 * @file user_boundaries.c
 * 
 * @brief aztekas user boundaries module
 * 
 * @author $author 
 *
 * @date $date
 */

#include"main.h"

void User_Boundaries(double *B)
{
}
EOF

if [[ $eos == 'User' ]]
then 
cat << EOF > user_eos.c
/**
 * @file user_eos.c
 * 
 * @brief aztekas user equation of state module
 * 
 * @author $author 
 *
 * @date $date
 */

#include"main.h"

/* Default equation of state --> Ideal gas */

void EoS(eos_ *eos, double *u, gauge_ *local_grid)
{
   double rho, p;
   rho = u[RHO];
   p   = u[PRE];

   /**
    * The neccesary variable to define in the EoS module
    * are:
    *    - eos->e  (HD and RHD): specific internal energy
    *    - eos->cs (HD and RHD): speed of sound
    *    - eos->h  (RHD): specific enthalpy
    *    - eos->dhdrho (PVRS integration): derivative dh/drho
    *    - eos->dhdp (PVRS integration): derivative dh/dp
    */

   eos->e = p / (rho * (K - 1.0));

#if PHYSICS == HD
   eos->cs = sqrt(K * p / rho);
#elif PHYSICS == RHD
   eos->h  = 1.0 + eos->e + p/rho;
   #if INTEGRATION == PVRS
   eos->dhdrho = - K*p/(rho*rho*(K - 1.0));
   eos->dhdp   = K/(rho*(K - 1.0));
   #endif
   eos->cs = sqrt(K * p / (rho * eos->h));
#endif
}
EOF
fi

if [[ $metric == 'User' ]]
then 
cat << EOF > user_metric.c
/**
 * @file user_metric.c
 * 
 * @brief aztekas user metric module
 * 
 * @author $author 
 *
 * @date $date
 */

#include"main.h"

void Get_Metric_Components(gauge_ *local_grid)
{
   /* Default metric --> Minkowski in Cartesian grid */

   /**
    * Lapse function \\alpha
    */
   local_grid->lapse = 1.0;                                                     
      
   /**
    * Shift vector \\beta^i
    */
   local_grid->beta_con[0] = 0.0;                                               
   local_grid->beta_con[1] = 0.0;                                               
   local_grid->beta_con[2] = 0.0;                                               
      
   /**
    * 3D-metric \\gamma^{ij}
    */
   local_grid->gamma_con[0][0] = 1.0;                                           
   local_grid->gamma_con[0][1] = 0.0;                                           
   local_grid->gamma_con[0][2] = 0.0;                                           
   local_grid->gamma_con[1][0] = 0.0;                                           
   local_grid->gamma_con[1][1] = 1.0;                                           
   local_grid->gamma_con[1][2] = 0.0;                                           
   local_grid->gamma_con[2][0] = 0.0;                                           
   local_grid->gamma_con[2][1] = 0.0;                                           
   local_grid->gamma_con[2][2] = 1.0;                                           
                                                                                
   /**
    * Sqrt root of the determinant of the
    * 3D-metric \gamma^{ij}
    */
   local_grid->dety = 1.0;                                                      
}

void Gauge_Derivatives(der_gauge_ *der, gauge_ *local_grid)
{
   /**
    * Spatial derivatives of the lapse function \\alpha
    */
   der->dlapse[0] = 0.0;
   der->dlapse[1] = 0.0;
   der->dlapse[2] = 0.0;

   /**
    * Spatial derivatives of the shift vector \\beta^i
    */
   der->dbeta[0][0] = 0.0;
   der->dbeta[0][1] = 0.0;
   der->dbeta[0][2] = 0.0;
   der->dbeta[1][0] = 0.0;
   der->dbeta[1][1] = 0.0;
   der->dbeta[1][2] = 0.0;
   der->dbeta[2][0] = 0.0;
   der->dbeta[2][1] = 0.0;
   der->dbeta[2][2] = 0.0;

   /**
    * Spatial derivatives of the shift vector \\gamma_{ij}
    */
   der->dgam[0][0][0] = 0.0;
   der->dgam[0][0][1] = 0.0;
   der->dgam[0][0][2] = 0.0;
   der->dgam[0][1][0] = 0.0;
   der->dgam[0][1][1] = 0.0;
   der->dgam[0][1][2] = 0.0;
   der->dgam[0][2][0] = 0.0;
   der->dgam[0][2][1] = 0.0;
   der->dgam[0][2][2] = 0.0;

   der->dgam[1][0][0] = 0.0;
   der->dgam[1][0][1] = 0.0;
   der->dgam[1][0][2] = 0.0;
   der->dgam[1][1][0] = 0.0;
   der->dgam[1][1][1] = 0.0;
   der->dgam[1][1][2] = 0.0;
   der->dgam[1][2][0] = 0.0;
   der->dgam[1][2][1] = 0.0;
   der->dgam[1][2][2] = 0.0;

   der->dgam[2][0][0] = 0.0;
   der->dgam[2][0][1] = 0.0;
   der->dgam[2][0][2] = 0.0;
   der->dgam[2][1][0] = 0.0;
   der->dgam[2][1][1] = 0.0;
   der->dgam[2][1][2] = 0.0;
   der->dgam[2][2][0] = 0.0;
   der->dgam[2][2][1] = 0.0;
   der->dgam[2][2][2] = 0.0;
}

EOF
fi

if [[ $user_sources == true ]]
then 
cat << EOF > user_sources.c
/**
 * @file user_sources.c
 * 
 * @brief aztekas user source terms module
 * 
 * @author $author 
 *
 * @date $date
 */

#include"main.h"

void User_Source_Terms(double *s, double *u, gauge_ *local_grid)
{
   double rho, p, vx1=0.0, vx2=0.0, vx3=0.0;

   rho = u[RHO];
   p   = u[PRE];
#if DIM == 1
   vx1 = u[VX1];
#elif DIM == 2
   vx1 = u[VX1];
   vx2 = u[VX2];
#elif DIM == 3 || dim == 4
   vx1 = u[VX1];
   vx2 = u[VX2];
   vx3 = u[VX3];
#endif

EOF

if [[ $grav == 'n' ]] || [[ $phy == 'RHD'  ]] || [[ $gravity == 0 ]]
then

cat << EOF >> user_sources.c
   s[RHO] = 0.0;
   s[PRE] = 0.0;
   s[VX1] = 0.0;
   s[VX2] = 0.0;
   s[VX3] = 0.0;
}
EOF
fi

if [[ $grav == 'y' ]]
then
if [[ $coord == 'cartesian' ]] && [[ $gravity == 1 ]]
then
cat << EOF >> user_sources.c
   double x = local_grid->x[1];
   double y = local_grid->x[2];
   double z = local_grid->x[3];
   double r = sqrt(x*x + y*y + z*z);

   s[RHO] = 0.0;
   s[PRE] = -rho*g*vx2;
   s[VX1] = 0.0;
   s[VX2] = -rho*g;
   s[VX3] = 0.0;
}
EOF
fi
if [[ $coord == 'cylindrical' ]] && [[ $gravity == 1 ]]
then
cat << EOF >> user_sources.c
   double R = local_grid->x[1];
   double z = local_grid->x[2];
   double r = sqrt(R*R + z*z);

   s[RHO] = 0.0;
   s[PRE] = -rho*g*vx2;
   s[VX1] = 0.0;
   s[VX2] = -rho*g;
   s[VX3] = 0.0;
}
EOF
fi
if [[ $coord == 'cartesian' ]] && [[ $gravity == 2 ]]
then
cat << EOF >> user_sources.c
   double x = local_grid->x[1];
   double y = local_grid->x[2];
   double z = local_grid->x[3];
   double r = sqrt(x*x + y*y + z*z);

   s[RHO] = 0.0;
   s[PRE] = -(rho*vx1*x + rho*vx2*y + rho*vx3*z)/pow(r,3.0);
   s[VX1] = -(rho*x)/pow(r,3.0);
   s[VX2] = -(rho*y)/pow(r,3.0);
   s[VX3] = -(rho*z)/pow(r,3.0);
}
EOF
fi
if [[ $coord == 'cylindrical' ]] && [[ $gravity == 2 ]]
then
cat << EOF >> user_sources.c
   double R = local_grid->x[1];
   double z = local_grid->x[2];
   double r = sqrt(R*R + z*z);

   s[RHO] = 0.0;
   s[PRE] = -(rho*vx1*R + rho*vx2*z)/pow(r,3.0);
   s[VX1] = -(rho*R)/pow(r,3.0);
   s[VX2] = -(rho*z)/pow(r,3.0);
   s[VX3] = 0.0;
}
EOF
fi
if [[ $coord == 'spherical' ]] && [[ $gravity == 2 ]]
then
cat << EOF >> user_sources.c
   double r = local_grid->x[1];

   s[RHO] = 0.0;
   s[PRE] = -rho*vx1/(r*r);
   s[VX1] = -rho/(r*r);
   s[VX2] = 0.0;
   s[VX3] = 0.0;
}
EOF
fi
fi
fi

cat << EOF > user_input.c
/**
 * @file user_input.c
 * 
 * @brief aztekas user input parameters module
 * 
 * @author Emilio Tejeda
 *
 * @date $date
 */

#include"main.h"

FILE *paramfile;

int User_Parameters(char const *paramfile_name)
{
   int   BUFFER_SIZE = 612;
   char t_key[BUFFER_SIZE], t_value[BUFFER_SIZE], t_firstChar;
   
   //if input paramfile_name is null
   if(!paramfile_name || *paramfile_name == '\0')
   {
      fprintf(stderr, "Invalid parameter file name\n");
      exit(EXIT_FAILURE);
   }
      
   //open file
   paramfile = fopen (paramfile_name, "r");

   if (paramfile == NULL)
   {
      fprintf(stderr, "Error opening parameter file: %s\n", paramfile_name);
      exit(EXIT_FAILURE);
   }
      
   //read individual settings lines
   while(fscanf(paramfile, " %c", &t_firstChar) == 1 )
   {

      if(t_firstChar != '/' && t_firstChar != '%')
      {
         // Not a comment so read the key value pair
         // Move back one space in the input stream with seek
         fseek(paramfile, -1, SEEK_CUR);

         if(fscanf (paramfile, "%s = %s", t_key, t_value) == 2)
         {
/*
            if(strcmp(t_key,"nl")==0)
            {
               nl = atof(t_value);
            }

            if(strcmp(t_key,"pl")==0)
            {
               pl = atof(t_value);
            }

            if(strcmp(t_key,"vx1l")==0)
            {
               vx1l = atof(t_value);
            }

            if(strcmp(t_key,"vx2l")==0)
            {
               vx2l = atof(t_value);
            }

            if(strcmp(t_key,"vx3l")==0)
            {
               vx3l = atof(t_value);
            }

            if(strcmp(t_key,"nr")==0)
            {
               nr = atof(t_value);
            }

            if(strcmp(t_key,"pr")==0)
            {
               pr = atof(t_value);
            }

            if(strcmp(t_key,"vx1r")==0)
            {
               vx1r = atof(t_value);
            }

            if(strcmp(t_key,"vx2r")==0)
            {
               vx2r = atof(t_value);
            }

            if(strcmp(t_key,"vx3r")==0)
            {
               vx3r = atof(t_value);
            }

            if(strcmp(t_key,"x_0")==0)
            {
               x_0 = atof(t_value);
            }
*/
         }
      }
            
      // Ignore the rest of the line.
      int fscanret = fscanf(paramfile, "%*[^\n]"); 
   }
      
   fclose(paramfile);         

   if(*outputfile == '\0')
   {
      printf("Check parameters file: Didn't find a name for output file\n");
      exit(EXIT_FAILURE);
   }

   return 0;   
}
EOF

cat << EOF > $char_name.param
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% PARAMETERS FOR SIMULATION %%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OUTPUT FILE AND DIRECTORY %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
outputdirectory = TEST/
outputfile      = ${char_name}_

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CHECK SIMULATION PARAMETERS (1 -> true, 0 -> false) %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
check_param = 0

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OUTPUT FORMAT (1 -> BINARY, 0 -> ASCII) %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
binary = 0

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RESTART SIMULATION (1 -> TRUE, 0 -> FALSE) %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
restart_simulation = 0
restartfile        = TEST/${char_name}_0.dat
restart_filecount  = 0

%%%%%%%%%%%%%%%
% DEFINE MESH %
%%%%%%%%%%%%%%%
Nx1 = 256
Nx2 = 0
Nx3 = 0

%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINE DOMAIN LIMITS %
%%%%%%%%%%%%%%%%%%%%%%%%

x1max = 1.0
x2max = 1.0
x3max = 1.0
x1min = 0.0
x2min = 0.0
x3min = 0.0

%%%%%%%%%%%%%%%%%%%
% TIME PARAMETERS %
%%%%%%%%%%%%%%%%%%%
tmax     = 1.0
timefile = 0.1
numfile  = 0

%%%%%%%%%%%%%%%%%%
% COURANT FACTOR %
%%%%%%%%%%%%%%%%%%
cou = 0.25

%%%%%%%%%%%%%%%%%%%%
% POLYTROPIC INDEX %
%%%%%%%%%%%%%%%%%%%%
K = 1.6666666666666666666666666666666666666

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BOUNDARY AND INITIAL PARAMETERS %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
EOF
